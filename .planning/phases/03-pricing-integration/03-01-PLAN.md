---
phase: 03-pricing-integration
plan: 01
type: execute
---

<objective>
Integrate Google Sheets as a build-time data source for pricing tables.

Purpose: Enable client to update pricing by editing a familiar spreadsheet interface — changes appear on next build.
Output: Pricing page displays tables from Google Sheets CSV, with fallback sample data for development.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-phase.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/02-gallery/02-01-SUMMARY.md

**From prior phases:**
- Astro 5.x with static output, SK/EN bilingual routing
- i18n pattern: pages in src/pages/{locale}/, translations in src/i18n/ui.ts
- BaseLayout.astro wraps all pages
- CSS variables and global.css for styling
- Pricing pages exist at src/pages/sk/cennik.astro and src/pages/en/pricing.astro (placeholder content)

**Key files to modify:**
- src/pages/sk/cennik.astro
- src/pages/en/pricing.astro
- src/lib/sheets.ts (new - data fetching utility)
- src/styles/global.css (pricing table styles)
- src/i18n/ui.ts (pricing-related translations)

**Google Sheets approach (from discovery):**
- Public sheet with "Anyone with link can view" permission
- CSV export URL format: `https://docs.google.com/spreadsheets/d/{SHEET_ID}/export?format=csv&gid={TAB_ID}`
- Fetch at build time using standard fetch() — Astro handles this in frontmatter
- Parse CSV into structured data for rendering
- No API key needed for public sheets

**Constraints:**
- Zero JS requirement — tables rendered as static HTML
- Static output — data fetched at build time only
- Must work with fallback data when sheet URL not configured (for development)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Google Sheets data fetching utility</name>
  <files>src/lib/sheets.ts, src/data/sample-pricing.ts</files>
  <action>
1. Create src/lib/sheets.ts with:
   - `fetchSheetAsCSV(sheetId: string, gid?: string): Promise<string[][]>` function
   - Uses fetch() to get CSV from Google Sheets export URL
   - Parses CSV into 2D array (handle quoted fields, commas in values)
   - Returns empty array on fetch failure (graceful degradation)
   - Export types for pricing data structure

2. Create src/data/sample-pricing.ts with:
   - Sample pricing data matching expected sheet structure
   - Two sections: Room rentals and Catering/Food prices
   - Structure: `{ rooms: [...], catering: [...] }`
   - Room: { name, halfDay, fullDay, notes }
   - Catering: { item, price, unit }

3. Add environment variable pattern:
   - Check for import.meta.env.PUBLIC_SHEETS_ID (optional)
   - If not set, use sample data
   - Document in README or .env.example

CSV parsing note: Simple split by comma works for basic data. If client uses commas in values, implement proper CSV parsing (split respecting quotes). Start simple, enhance if needed.
  </action>
  <verify>TypeScript compiles without errors: npm run build passes</verify>
  <done>sheets.ts utility exists with fetchSheetAsCSV function, sample-pricing.ts has placeholder data</done>
</task>

<task type="auto">
  <name>Task 2: Create PricingTable component and update pricing pages</name>
  <files>src/components/PricingTable.astro, src/pages/sk/cennik.astro, src/pages/en/pricing.astro, src/styles/global.css, src/i18n/ui.ts</files>
  <action>
1. Create src/components/PricingTable.astro:
   - Props: title (string), headers (string[]), rows (string[][]), highlight (boolean, optional)
   - Renders semantic HTML table with thead/tbody
   - Supports optional row highlighting for featured items
   - Uses CSS classes for styling (no inline styles)

2. Update src/pages/sk/cennik.astro:
   - Import sheets utility and sample data
   - In frontmatter: Try to fetch from sheet, fall back to sample data
   - Render two sections: "Prenájom miestností" (Room rentals) and "Catering"
   - Use PricingTable component for each section
   - Add section headers and any intro text

3. Update src/pages/en/pricing.astro:
   - Same structure as SK page
   - English headers and labels
   - Same data source (sheet has both languages or use sample data)

4. Add translations to src/i18n/ui.ts:
   - 'pricing.roomRentals': 'Prenájom miestností' / 'Room Rentals'
   - 'pricing.catering': 'Catering a občerstvenie' / 'Catering & Refreshments'
   - 'pricing.halfDay': 'Poldeň' / 'Half Day'
   - 'pricing.fullDay': 'Celý deň' / 'Full Day'
   - 'pricing.perPerson': 'na osobu' / 'per person'
   - 'pricing.notes': 'Poznámky' / 'Notes'

5. Add CSS to src/styles/global.css:
   - .pricing-table: Clean table styling with borders
   - .pricing-table th: Header styling (olive green background)
   - .pricing-table td: Cell padding, alignment
   - .pricing-table--highlight: Optional row highlight
   - Responsive: Stack columns on mobile if needed (or horizontal scroll)
   - Match olive green theme from existing styles
  </action>
  <verify>npm run build succeeds, open dist/sk/cennik/index.html shows pricing tables with sample data</verify>
  <done>Pricing pages display formatted tables, both SK and EN versions work, tables are responsive</done>
</task>

<task type="auto">
  <name>Task 3: Test with real Google Sheet (optional) and document setup</name>
  <files>.env.example, README.md or docs in .planning/</files>
  <action>
1. Create .env.example documenting:
   ```
   # Google Sheets ID (from sheet URL)
   # https://docs.google.com/spreadsheets/d/THIS_IS_THE_ID/edit
   PUBLIC_SHEETS_ID=

   # Optional: Specific tab ID (gid parameter)
   PUBLIC_SHEETS_GID=0
   ```

2. Document the setup process:
   - How to create the Google Sheet with correct structure
   - Expected columns: Name | Half Day | Full Day | Notes (for rooms)
   - Expected columns: Item | Price | Unit (for catering)
   - How to make sheet public ("Anyone with link can view")
   - How to find the sheet ID from URL
   - Note: Changes require rebuild to appear on site

3. Verify build works:
   - Without env vars: Uses sample data (development mode)
   - Build outputs static HTML with pricing tables
   - No runtime JavaScript required

Note: Testing with an actual Google Sheet is optional for this phase. The utility is built to work, and can be verified when client provides their sheet.
  </action>
  <verify>npm run build succeeds with and without env vars, .env.example exists with clear documentation</verify>
  <done>Environment setup documented, build works with sample data fallback, ready for client to provide sheet URL</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Pricing page (SK) shows room rental table with sample data
- [ ] Pricing page (EN) shows same structure with English labels
- [ ] Tables are styled consistently with site theme
- [ ] No JavaScript files added (check dist/ for .js files)
- [ ] .env.example documents Google Sheets setup
- [ ] Sample data works when no sheet URL configured
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Pricing tables display correctly in both languages
- Build-time data fetching pattern established
- Client setup process documented
- Zero JS in output maintained
</success_criteria>

<output>
After completion, create `.planning/phases/03-pricing-integration/03-01-SUMMARY.md`:

# Phase 3 Plan 01: Pricing Integration Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
- [Key decisions and rationale, or "None"]

## Issues Encountered
- [Problems and resolutions, or "None"]

## Next Phase Readiness
- [What's ready for Phase 4]
- [Any concerns or blockers]
</output>
