---
import BaseLayout from '../../layouts/BaseLayout.astro';
import RoomComparisonTable from '../../components/RoomComparisonTable.astro';
import { Image } from 'astro:assets';
import { useTranslations } from '../../i18n/utils';
import { rooms } from '../../data/rooms';

import floorplan1 from '../../assets/floorplans/floorplan1.webp';
import floorplan2 from '../../assets/floorplans/floorplan2.webp';
import floorplanCafe from '../../assets/floorplans/floorplan_cafe.webp';

const lang = 'sk';
const t = useTranslations(lang);

const floorplans = [
  { id: 'floor1', image: floorplan1, label: t('roomOverview.floorplan.floor1') },
  { id: 'floor2', image: floorplan2, label: t('roomOverview.floorplan.floor2') },
  { id: 'cafeteria', image: floorplanCafe, label: t('roomOverview.floorplan.cafeteria') },
];
---

<BaseLayout
  title={`${t('page.roomOverview.title')} | ${t('ui.siteName')}`}
  description={t('page.roomOverview.description')}
  lang={lang}
>
  <div class="room-overview-page">
    <h1>{t('page.roomOverview.title')}</h1>
    <p class="room-overview-intro">{t('roomOverview.intro')}</p>

    <div class="floorplan-section">
      <h2>{t('roomOverview.floorplans')}</h2>
      <div class="floorplan-buttons">
        {floorplans.map((fp) => (
          <button type="button" class="floorplan-btn" data-floorplan-id={fp.id}>
            <Image src={fp.image} alt={fp.label} width={120} height={80} class="floorplan-thumb" />
            <span class="floorplan-label">{fp.label}</span>
          </button>
        ))}
      </div>
    </div>

    <RoomComparisonTable rooms={rooms} lang={lang} />

    <p class="room-overview-cta">
      {t('roomOverview.cta')} <a href={`/${lang}/cennik/`}>{t('roomOverview.pricingLink')}</a>.
    </p>
  </div>

  <!-- Lightbox Modal -->
  <div class="lightbox" id="floorplan-lightbox" aria-hidden="true">
    <div class="lightbox-overlay"></div>
    <button type="button" class="lightbox-close" aria-label="ZavrieÅ¥">&times;</button>
    <div class="lightbox-content">
      {floorplans.map((fp) => (
        <Image
          src={fp.image}
          alt={fp.label}
          width={1200}
          class="lightbox-image"
          id={`lightbox-img-${fp.id}`}
          data-lightbox-id={fp.id}
        />
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .room-overview-page {
    max-width: 900px;
    margin: 0 auto;
  }

  .room-overview-intro {
    margin-bottom: 2rem;
    color: var(--color-text-light);
    font-size: 1.1rem;
  }

  .room-overview-cta {
    margin-top: 2rem;
    font-size: 1.1rem;
  }

  .room-overview-cta a {
    color: var(--color-primary);
    font-weight: 500;
  }

  .room-overview-cta a:hover {
    color: var(--color-primary-dark);
    text-decoration: underline;
  }

  /* Floorplan Section */
  .floorplan-section {
    margin-bottom: 2.5rem;
  }

  .floorplan-section h2 {
    font-size: 1.25rem;
    color: var(--color-primary-dark);
    margin-bottom: 1rem;
  }

  .floorplan-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  .floorplan-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    background-color: #fff;
    border: 2px solid var(--color-border, #ddd);
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .floorplan-btn:hover {
    border-color: var(--color-primary, #6B4423);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .floorplan-thumb {
    border-radius: 4px;
    object-fit: cover;
  }

  .floorplan-label {
    margin-top: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--color-text, #333);
  }

  /* Lightbox */
  .lightbox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }

  .lightbox[aria-hidden="false"] {
    display: flex;
  }

  .lightbox-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
  }

  .lightbox-close {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    background: none;
    border: none;
    color: white;
    font-size: 3rem;
    cursor: pointer;
    line-height: 1;
    z-index: 10000;
    padding: 0.5rem;
  }

  .lightbox-close:hover {
    color: #ccc;
  }

  .lightbox-content {
    position: relative;
    z-index: 10000;
    max-width: 90vw;
    max-height: 90vh;
  }

  .lightbox-image {
    display: none;
    max-width: 90vw;
    max-height: 85vh;
    width: auto;
    height: auto;
    object-fit: contain;
  }

  .lightbox-image.is-visible {
    display: block;
  }

  @media (max-width: 600px) {
    .floorplan-buttons {
      flex-direction: column;
      align-items: stretch;
    }

    .floorplan-btn {
      flex-direction: row;
      gap: 1rem;
      padding: 0.75rem;
    }

    .floorplan-thumb {
      width: 80px;
      height: 53px;
    }

    .floorplan-label {
      margin-top: 0;
    }
  }
</style>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const lightbox = document.getElementById('floorplan-lightbox');
    const buttons = document.querySelectorAll('[data-floorplan-id]');
    const closeBtn = lightbox ? lightbox.querySelector('.lightbox-close') : null;
    const overlay = lightbox ? lightbox.querySelector('.lightbox-overlay') : null;
    const images = document.querySelectorAll('[data-lightbox-id]');

    function openLightbox(id) {
      if (!lightbox) return;

      // Hide all images first
      images.forEach(function(img) {
        img.classList.remove('is-visible');
      });

      // Show selected image
      const targetImg = document.getElementById('lightbox-img-' + id);
      if (targetImg) {
        targetImg.classList.add('is-visible');
      }

      // Show lightbox
      lightbox.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeLightbox() {
      if (!lightbox) return;
      lightbox.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    // Button click handlers
    buttons.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        var id = btn.getAttribute('data-floorplan-id');
        openLightbox(id);
      });
    });

    // Close handlers
    if (closeBtn) {
      closeBtn.addEventListener('click', function(e) {
        e.preventDefault();
        closeLightbox();
      });
    }

    if (overlay) {
      overlay.addEventListener('click', closeLightbox);
    }

    // Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && lightbox && lightbox.getAttribute('aria-hidden') === 'false') {
        closeLightbox();
      }
    });
  });
</script>
