---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '../../i18n/utils';
import { getRoomPricingRows } from '../../data/room-pricing';

const lang = 'en';
const t = useTranslations(lang);

// Get room rows (prices loaded client-side)
const roomRows = getRoomPricingRows(lang);
---

<BaseLayout
  title={`${t('page.pricing.title')} | ${t('ui.siteName')}`}
  description={t('page.pricing.description')}
  lang={lang}
>
  <div class="pricing-page">
    <h1>{t('page.pricing.title')}</h1>
    <p class="pricing-intro">{t('pricing.intro')}</p>

    <div class="pricing-section">
      <h2 class="pricing-section__title">{t('pricing.roomRentals')}</h2>
      <div class="pricing-table-wrapper">
        <table class="pricing-table" id="room-pricing-table">
          <thead>
            <tr>
              <th>Training Room</th>
              <th>Room size</th>
              <th>U-shape seating</th>
              <th>Price per day (8:00-17:00)*</th>
            </tr>
          </thead>
          <tbody>
            {roomRows.map(room => (
              <tr>
                <td class="pricing-table__name">
                  {room.link ? (
                    <a href={room.link} class="pricing-table__link">{room.name}</a>
                  ) : (
                    room.name
                  )}
                </td>
                <td>{room.floorSize}</td>
                <td>{room.capacity}</td>
                <td data-room-price={room.id}></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>

    <div class="catering-section">
      <div class="pricing-section">
        <h2 class="pricing-section__title">{t('pricing.catering')}</h2>
        <div class="pricing-table-wrapper">
          <table class="pricing-table" id="catering-pricing-table">
            <thead>
              <tr>
                <th>Lunch and Refreshments</th>
                <th>Price</th>
              </tr>
            </thead>
            <tbody id="catering-body">
            </tbody>
          </table>
        </div>
      </div>
      <p class="catering-note">*Option to arrange individual refreshment packages</p>
    </div>

    <div class="pricing-disclaimer">
      <p>All prices are listed without VAT.</p>
      <p>* Price per day applies from 8:00 AM to 5:00 PM.<br />
      Individual arrangements are possible for use outside these hours.</p>
      <p class="pricing-year">Price list valid for 2026.</p>
    </div>
  </div>
</BaseLayout>

<script>
  async function loadPrices() {
    try {
      const response = await fetch('/prices.json');
      const data = await response.json();

      // Update room prices
      document.querySelectorAll('[data-room-price]').forEach(cell => {
        const roomId = cell.getAttribute('data-room-price');
        if (roomId && data.rooms[roomId]) {
          const price = data.rooms[roomId];
          cell.textContent = price.includes('EUR') ? price : `${price} EUR`;
        }
      });

      // Update catering table
      const cateringBody = document.getElementById('catering-body');
      const cateringData = data.catering['en'];

      if (cateringBody && cateringData) {
        cateringBody.innerHTML = cateringData.map((item: { item: string; price: string }) =>
          `<tr><td>${item.item}</td><td>${item.price}</td></tr>`
        ).join('');
      }
    } catch (error) {
      console.error('Failed to load prices:', error);
    }
  }

  loadPrices();
</script>

<style>
  .pricing-page {
    max-width: 900px;
    margin: 0 auto;
  }

  .pricing-intro {
    margin-bottom: 2rem;
    color: var(--color-text-light);
    font-size: 1.1rem;
  }

  .pricing-disclaimer {
    margin-top: 2rem;
    padding: 1.5rem;
    background: var(--color-background-alt);
    border-radius: 4px;
    font-size: 0.9rem;
    color: var(--color-text-light);
  }

  .pricing-disclaimer p {
    margin-bottom: 0.75rem;
  }

  .pricing-disclaimer p:last-child {
    margin-bottom: 0;
  }

  .pricing-year {
    font-weight: 600;
    color: var(--color-text);
  }

  .catering-section {
    max-width: 400px;
  }

  .catering-note {
    margin-top: 0.5rem;
    font-size: 0.85rem;
    color: var(--color-text-light);
    font-style: italic;
  }

  .pricing-table__link {
    color: var(--color-primary);
    text-decoration: underline;
    font-weight: 600;
  }

  .pricing-table__link:hover {
    color: var(--color-primary-dark);
    text-decoration: none;
  }
</style>
